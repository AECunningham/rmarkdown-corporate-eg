---
title: "Demonstration page of R Markdown in combination with corporate theming"
author: "Flash Gordon, economist extraordinaire"
date: "6 September 2017"
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
    number_sections: true
    self_contained: yes
    css: corp-styles.css
    highlight: pygments
---

<img src="logo.svg" style="position:absolute;top:0px;right:0px;" />

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, cache = FALSE, eval = TRUE)
source("corp-palette.R")
load(paste0(proj_dir, "/data/mrtes.rda"))
```

# Executive Summary


# Purpose

This is basically just a demo

# Analysis

## Data

We found this data from [MBIE's website](http://www.mbie.govt.nz/info-services/sectors-industries/tourism/tourism-research-data/monthly-regional-tourism-estimates/data-download).  MBIE is the Ministry of Business, Innovation and Employment.  This dataset represents estimated spend per month by tourists, broken down by product and country of origin.

## Findings

### Raw data

We see a very strong seasonal pattern, and also that people spend a lot on accommodation, food and beverage, and retail.

```{r}
p <- mrtes %>%
  mutate(Product = str_wrap(Product, 20)) %>%
  ggplot(aes(x = Date, y = Spend, colour = RTO)) +
  facet_wrap(~Product) +
  theme(legend.position = "none")

p + geom_line()
```


### Seasonally adjusted

Some of the pattern is obscured by the strongly seasonal element.  There are more tourists in summer than winter in New Zealand.  We can use statistical methods to adjust for the seasonality and focus more on the trend:


```{r}
p +   stat_stl(frequency = 12, s.window = 7)

```


### Trends

If we pick 8 RTOs at random we see some interesting trends

```{r}
set.seed(123)
mrtes %>%
  mutate(RTO = fct_lump(RTO, 8, ties.method = "random")) %>%
  group_by(RTO, Date, Product) %>%
  summarise(Spend = sum(Spend)) %>%
  filter(Product != "Other passenger transport") %>%
  mutate(Product = str_wrap(Product, 20)) %>%
  ggplot(aes(x = Date, y = Spend, colour = Product)) +
  facet_wrap(~RTO, scales = "free_y") +
  # theme(legend.position = "none") +
  stat_stl(frequency = 12, s.window = 7, index.ref = 1:12)
```
